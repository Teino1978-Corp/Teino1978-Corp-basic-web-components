<!--
A combo box which presents its choices as a dropdown list.

@element basic-list-combo-box
@demo http://basic-web-components.github.io/basic-web-components/src/basic-list-combo-box/?dom=shadow
-->

<link rel="import" href="../basic-combo-box/basic-combo-box.html">
<link rel="import" href="../basic-list-box/basic-list-box.html">

<dom-module id="basic-list-combo-box">
  <template>

    <style>
    :host {
      display: -webkit-inline-flex;
      display: inline-flex;
    }

    #comboBox {
      -webkit-flex: 1;
      flex: 1;
    }

    #listBox {
      --basic-list-box: {
        border: none;
      };
    }
    </style>

    <basic-combo-box id="comboBox" dont-open-on-focus="{{dontOpenOnFocus}}" value="{{value}}">
      <basic-list-box id="listBox" class="popup" selected-item="{{selectedItem}}" tabindex="-1">
        <content></content>
      </basic-list-box>
    </basic-combo-box>

  </template>
</dom-module>

<script>
Polymer({

  is: 'basic-list-combo-box',

  get inputElement() {
    return this.$.comboBox.inputElement;
  },

  get items() {
    return this.$.listBox.items;
  },

  ready: function() {
    // Indicate which navigation keys we want to handle.
    this.$.comboBox.popupKeys = [
      33, // Page Up
      34, // Page Down
      35, // End
      36, // Home
      38, // Up
      40  // Down
    ];

    // HACK: Force value attribute specified on tag to be displayed.
    // TODO: Investigate to see whether this is a Polymer bug.
    if (this.inputElement.value !== this.value) {
      this.inputElement.value = this.value;
    }
  },

  get popupElement() {
    return this.$.comboBox.popupElement;
  },

  properties: {

    dontOpenOnFocus: {
      notify: true,
      type: Boolean,
      value: false
    },

    selectedItem: {
      notify: true,
      observer: '_selectedItemChanged',
      type: Object
    },

    value: {
      notify: true,
      type: String
    }

  },

  _selectedItemChanged: function() {
    var selectedItem = this.selectedItem;
    var inputElement = this.inputElement;
    if (inputElement) {
      var value = selectedItem instanceof HTMLElement ? selectedItem.textContent : selectedItem;
      inputElement.value = value;
    }
  }

});
</script>
