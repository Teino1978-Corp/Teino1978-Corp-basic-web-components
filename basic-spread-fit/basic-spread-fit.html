<!--
Spread out a set of items so they take equal space.
-->

<link rel="import" href="../basic-aspect/basic-aspect.html">
<link rel="import" href="../basic-stack/basic-stack.html">

<dom-module id="basic-spread-fit">
  <style>
  :host {
    display: inline-block;
    overflow: hidden;
    position: relative;
  }

  basic-stack {
    display: inline-block;
  }

  #stack ::content .item {
    transform: translate(-50%, -50%);
  }
  </style>
  <template>
    <basic-stack id="stack">
      <content></content>
    </basic-stack>
  </template>
</dom-module>

<script>
Polymer(mixin(BasicAspectMixin, {

  contribute: {

    itemAdded: function(item) {
      /*
       * We want to be able to style children that might be reprojected. This
       * is easy to accomplish in native Shadow DOM, but hard in Shady DOM.
       * To simplify this, we apply a class to all children, then define a rule
       * to style everything with that class.
       */
      item.classList.add('item');
    }

  },

  hostAttributes: {
    target: 'shadow'
  },

  is: 'basic-spread-fit',

  ready: function() {
    this.$.stack.addEventListener('basic-layout', function(event) {
      this._layout(event.detail.width, event.detail.height);
    }.bind(this));
  },

  recalc: function() {
    this.$.stack.recalc();
  },

  _layout: function(width, height) {
    var count = this.content.length;
    this.style.width = (count * width) + 'px';
    this.style.height = height + 'px';
    this.content.forEach(function(element, index) {
      var offset = (index + 0.5) * width;
      element.style.left = offset + 'px';
      element.style.top = '50%';
    });
  }

}));
</script>
